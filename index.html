<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- 임시 CDN -->
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/normalize.css">
    <link rel="stylesheet" type="text/css" href="/style.css">
    <title>은졔의 리액트 겅부방</title>
</head>
<body>
    <div id="root">
        <b>어떤 은지혜가 좋으세요?</b>
        <div class="ui-dropdown" id="dropdown1">
            <select name="" id="">
                <option value="v1">은지혜은지혜은지혜은지혜은지혜은지혜</option>
                <option value="v2">둘지혜</option>
                <option value="v3">셋지혜</option>
                <option value="v4">넷지혜</option>
                <option value="v5">다섯지혜</option>
                <option value="v6">육지혜</option>
            </select>
        </div>
        <div style="width: 100%; height: 500px; background: pink;">
            위치확인<br>
            위치확인<br>
            위치확인<br>
            위치확인<br>
            위치확인<br>
            위치확인<br>
            위치확인<br>
            위치확인<br>
            위치확인<br>
            위치확인<br>
            위치확인<br>
        </div>
    </div>

    <script type="text/babel">
        'use strict';

        var dropdown = (function(){
            var id = null,
                $drd = null,
                $btnTgl = null,    // drd 토글 버튼
                $drdList = null,    // drd list
                items = null,
                options = [];
            function setting() {
                items = $drd.getElementsByTagName('select')[0];
                items.classList.add('ui-hidden');
                Array.prototype.forEach.call(items.children, (element) =>
                    options.push(element)
                );
                makeBtns();
            }
            function makeBtns() {
                // items는 유사배열이기 때문에 배열의 메서드를 사용할 수 없다.
                // 따라서 배열 메서드를 빌려 쓰기 위해 call이나 apply 이용
                var btns = [],
                    drdList = document.createElement('div'),
                    btnTgl = document.createElement('button');
                btnTgl.className = 'ui-dropdown-btn toggle-dropdown';
                btnTgl.innerHTML = items.children[0].text;
                drdList.className = 'ui-dropdown-list';
                // 객체 추가
                $drd.appendChild(btnTgl);
                $drd.appendChild(drdList);
                // 객체 대입
                $btnTgl = $drd.getElementsByClassName('toggle-dropdown')[0];
                $drdList = $drd.getElementsByClassName('ui-dropdown-list')[0];
                Array.prototype.forEach.call(items.children,
                    (element, i) => {
                        function AddBtns(props) {
                            const btn = React.createElement(
                                'button', {
                                    type: 'button',
                                    className: 'ui-dropdown-btn',
                                    value: props.value
                                },
                                props.text
                            )
                            return btn;
                        }
                        btns.push(<AddBtns key={i} value={element.value} text={element.text}/>);
                        if (i === items.length-1) {
                            ReactDOM.render(
                                btns,
                                $drdList
                            )
                        }

                        /*
                        // [방법 2] 단순히 js로 태그 추가(innerHTML 사용)
                        // appendChild와 innerHTML += 중, 속도는 appendChild가 더 빠르다.
                        // appendChild = 추가 데이터만 등록, innerHTML = 전체 데이터 + 추가 데이터 모두 불러옴.
                        btns += `<button type="button" class="ui-dropdown-btn" value="${element.value}">${element.text}</button>`;
                        $drdList.innerHTML = btns;
                        */

                    }   
                )
            }
            function toggleList() {
                $btnTgl.classList.toggle('active');
                $drdList.classList.toggle('active');

                
                /*
                // [클래스 컴포넌트 내 로컬 변수로 객체 생성하기]
                class Test extends React.Component{
                    constructor(props){
                        super(props);
                        this.state = {
                            element: null
                        }
                    };
                    componentDidMount() {
                        this.setState( {
                            element: React.createElement(
                                'h1', {
                                    className: 'hihi',
                                },
                                '안녕하세요'
                            )
                        })
                    };
                    render() {
                        return (
                            <div>
                                {this.state.element}
                            </div>
                        )
                    }
                };
                ReactDOM.render(
                    <Test />,
                    document.getElementById('root')
                )
                */
                
            }
            function selectItem() {
                var fnSelectBtn,
                    $selectBtn,
                    $selectOption,
                    index;

                // 드로다운 버튼 하나하나에
                Array.prototype.forEach.call($drdList.children,
                    ($btnItem) => {
                        // 다음 클릭 이벤트를 건다
                        $btnItem.addEventListener('click', fnSelectBtn = function(e) {
                            // 모든 option의 select 초기화
                            Array.prototype.forEach.call(items.children,
                                (element) => element.removeAttribute('selected')
                            )
                            $selectBtn = e.target;
                            $btnTgl.innerText = $selectBtn.innerText;
                            // 선택된 요소가 몇번 째 노드인지 반환
                            for (var i=0; i<$drdList.children.length; i++) {
                                if ($drdList.children[i] === $selectBtn) {
                                    index = i;
                                    break;
                                }
                            }
                            // 선택된 요소와 (인덱스로) 매치되는  option 노드 세팅
                            options[index].setAttribute('selected', 'selected');
                            $btnTgl.classList.remove('active');
                            $drdList.classList.remove('active');
                        });
                    }
                );
            }
            return {
                init(opt) {
                    id = opt.id;
                    $drd = document.getElementById(id);
                    setting();
                    $btnTgl.addEventListener('click', ()=>{
                        toggleList();
                    }, false);
                    selectItem();
                }
            }
        })();

        dropdown.init({
            id: 'dropdown1'
        })
    </script>
</body>
</html>